/* admin-editor-init.js — built minified file (automatically generated) */






(function () {
function ready(cb) { if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', cb); else cb(); }

ready(function () {
const container = document.getElementById('editor-canvas');
if (!container) return;

const textarea = document.getElementById('editor-content');
const form = container.closest('form') || document.querySelector('form');

const initialText = (textarea && textarea.value) ? textarea.value : '';

const vendorLoader = '/assets/vendor/monaco-editor/min/vs/loader.js';

function insertScript(src, onload, onerror) {
const s = document.createElement('script');
s.src = src; s.async = true;
s.onload = onload; s.onerror = onerror;
document.head.appendChild(s);
}



function setStatus(msg, isError) {
try {
const statusEl = container.querySelector('.editor-status');
if (statusEl) {
statusEl.textContent = msg;
statusEl.style.color = isError ? '#f87171' : '#d1d5db';
}
console.debug('Editor status:', msg);
} catch (_) {}
}

function configureAndCreate(loaderUrl) {
setStatus('Configuring editor…');
try {
const base = (loaderUrl || '').replace(/\/loader\.js$/, '');
if (typeof window.require === 'function') {
try { window.require.config({ paths: { vs: base } }); } catch (_) {}
}


function siteToMonacoTheme() { return document.documentElement.classList.contains('dark') ? 'vs-dark' : 'vs'; }


if (typeof window.require === 'function') {

setStatus('Waiting for loader...', false);
const start = Date.now();
let polls = 0;
const wait = function () {
polls++;
if (typeof window.require === 'function') {

setStatus('Loading editor modules…', false);
return window.require(['vs/editor/editor.main'], function () {
try { createEditor(siteToMonacoTheme()); } catch (e) { console.error('editor init failed', e); setStatus('Editor init failed', true); }
}, function (err) {
console.error('require failed for editor.main', err);
setStatus('Failed to load editor modules via AMD — trying direct bundle', true);

insertScript(base + '/editor/editor.main.js', function () {
setStatus('Editor bundle loaded — creating editor', false);
if (window.monaco) createEditor(siteToMonacoTheme());
}, function () {
console.warn('direct editor.main injection failed');
setStatus('Editor bundle not available', true);
});
});
}
if (Date.now() - start < 5000) return setTimeout(wait, 80);

console.warn('Timed out waiting for AMD require — trying direct editor.main injection');
setStatus('Loader present but not responding — trying direct bundle', true);
insertScript(base + '/editor/editor.main.js', function () {
setStatus('Editor bundle loaded — creating editor', false);
if (window.monaco) createEditor(siteToMonacoTheme());
}, function () {
console.warn('direct editor.main injection failed (timeout)');
setStatus('Failed to load the editor; fallback to textarea', true);
});
};
wait();
return;
} else if (window.monaco) {

createEditor(siteToMonacoTheme());
} else {

insertScript(base + '/editor/editor.main.js', function () {
if (window.monaco) createEditor(siteToMonacoTheme());
}, function () { console.warn('direct editor.main injection failed'); });
}
} catch (e) { console.error('configureAndCreate failed', e); setStatus('Configuration error', true); }
}

function createEditor(theme) {
setStatus('Creating editor…', false);
if (!window.monaco || !container) return;
const ed = monaco.editor.create(container, {
value: initialText,
language: 'php',
theme: theme,
automaticLayout: true,
minimap: { enabled: false },
fontSize: 12,
lineNumbers: 'on',
wordWrap: 'off'
});




try { ed.updateOptions({ minimap: { enabled: false } }); } catch(_) {}
try { if (typeof ed.layout === 'function') ed.layout(); } catch(_) {}


if (textarea) textarea.classList.add('hidden');


if (form && textarea) {
form.addEventListener('submit', function () { try { textarea.value = ed.getValue(); } catch (_) {} });
}


window.AdminEditor = window.AdminEditor || {};
window.AdminEditor.editor = ed;
setStatus('Editor ready', false);
}



setStatus('Checking vendor loader…');
if (typeof fetch === 'function') {
fetch(vendorLoader, { method: 'HEAD' }).then(function (res) {
if (res.ok) {
setStatus('Loading vendor loader…');
insertScript(vendorLoader, function () { configureAndCreate(vendorLoader); }, function () {
console.info('vendor loader failed to execute');
setStatus('Vendor loader failed to execute — editor unavailable', true);
});
} else {
console.info('vendor loader not present (HTTP ' + res.status + ')');
setStatus('Vendor loader not present — please vendor the editor locally (see docs/scripts/install_monaco.sh)', true);
}
}).catch(function (e) {
console.debug('Failed to probe vendor loader by HEAD; falling back to trying vendor script directly', e);
insertScript(vendorLoader, function () { configureAndCreate(vendorLoader); }, function () { console.info('vendor loader not present (probe failed)'); setStatus('Vendor loader not present (probe failed) — please vendor the editor locally', true); });
});
} else {

insertScript(vendorLoader, function () { configureAndCreate(vendorLoader); }, function () { console.info('vendor loader not present, editor unavailable'); setStatus('Vendor loader not present — please vendor the editor locally', true); });
}
});
})();
